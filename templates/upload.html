<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Media</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body.purple {
      --bg-color: #fdfdfd;
      --bg-text: #1f2937;
      --aside-bg: #7021b6;
      --aside-text: #fff;
      --top: #fff;
      --button-bg: #6b21a8;
      --note-text: #374151;
      --aside-hover: #d8b4fe;
      --top-hover: #9b61ce;
      --titletop: #7021b6;
    }

    body.light {
      --bg-color: #fdfdfd;
      --bg-text: #1f2937;
      --aside-bg: #c9c9c9;
      --aside-text: #000000;
      --top: #fff;
      --button-bg: #a3a3a3;
      --note-text: #374151;
      --aside-hover: #424242;
      --top-hover: #747474;
      --titletop: #000;
    }

    body.dark {
      --bg-color: #373737;
      --bg-text: #ffffff;
      --aside-bg: #222222;
      --aside-text: #fff;
      --top: #3b3b3b;
      --button-bg: #616161;
      --note-text: #ffffff;
      --aside-hover: #8b8b8b;
      --top-hover: #6f6f6f;
      --titletop: #fff;
    }

    body {
      background-color: var(--bg-color);
      color: var(--bg-text);
      display: flex;
    }

    aside {
      width: 16rem;
      height: 100vh;
      background-color: var(--aside-bg);
      color: var(--aside-text);
      padding: 1.5rem;
      position: fixed;
      top: 0;
      left: 0;
    }

    aside > * + * {
      margin-top: 1rem;
    }

    .sidebar {
      display: block;
      color: var(--aside-text);
    }

    .sidebar:hover {
      color: var(--aside-hover);
    }

    header {
      background-color: var(--top);
    }

    h1 {
      color: var(--titletop);
    }

    label{
      color: var(--titletop);
    }

    p {
      color: var(--note-text);
    }
    form {
      background-color: var(--top);
    }

    button {
      background-color: var(--button-bg);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
    }

    input {
      background-color: var(--top);

    }

    button:hover {
      background-color: var(--top-hover);
    }

    .note-card {
      background-color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .note-footer {
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: #555;
    }

    video, img {
      border-radius: 4px;
      max-width: 100%;
      height: auto;
    }
  </style>
</head>

<body class="{{ current_user.theme if current_user.is_authenticated else 'purple' }}">
  <aside>
    <h2 class="text-2xl font-bold mb-6">Purple Note</h2>
    <nav class="space-y-4">
      <a href="{{ url_for('feed') }}" class="sidebar">üè† Feed</a>
      <a href="{{ url_for('serve_index') }}" class="sidebar">üìù My Notes</a>
      <a href="{{ url_for('explore') }}" class="sidebar">üîç Explore</a>
      <a href="{{ url_for('tasks') }}" class="sidebar">ü§ñ Task Manager</a>
      <a href="{{ url_for('upload_file') }}" class="sidebar">üìÇ Upload</a>
      <a href="{{ url_for('profile') }}" class="sidebar">üë§ Profile</a>
      <a href="{{ url_for('logout') }}" class="sidebar">üö™ Logout</a>
    </nav>
  </aside>

  <div class="ml-64 flex-1">
    <header class="shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
      <h1 class="text-xl font-bold">Upload Media</h1>
    </header>

    <main class="p-6 space-y-6">
      <form method="POST" enctype="multipart/form-data" class="p-6 rounded shadow-md">
        <label class="block mb-2">Title</label>
        <input type="text" id="media-title" name="title" class="w-full p-2 border mb-4 rounded" required />

        <label class="block mb-2">Select File</label>
        <input type="file" id="media-file" name="file" class="w-full p-2 border mb-4 rounded" accept="image/*,video/*" required />

        <button type="submit">Upload</button>
      </form>

      <div id="preview-container" class="flex flex-wrap gap-4"></div>

      <h1 class="text-xl font-bold">Uploaded Files</h1>

      {% if uploads_by_category %}
        {% for category, uploads in uploads_by_category.items() %}
          <h2 class="text-lg font-semibold mt-6">{{ category }}</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            {% for u in uploads %}
              <div class="note-card">
                {% if u.filetype == 'image' %}
                  <img src="{{ url_for('static', filename='uploads/' ~ u.user_id|string ~ '/' ~ u.filename) }}" alt="Uploaded Image">
                {% else %}
                  <video controls>
                    <source src="{{ url_for('static', filename='uploads/' ~ u.user_id|string ~ '/' ~ u.filename) }}">
                  </video>
                {% endif %}
                <div class="note-footer">
                  Uploaded by @{{ u.user.username }}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endfor %}
      {% else %}
        <p>No uploads yet.</p>
      {% endif %}
    </main>
  </div>

  <script>
    const mediaFileInput = document.getElementById('media-file');
    const previewContainer = document.getElementById('preview-container');

    mediaFileInput.addEventListener('change', () => {
      previewContainer.innerHTML = '';
      const mediaFile = mediaFileInput.files[0];
      const mediaTitle = document.getElementById('media-title').value || 'Untitled';

      if (!mediaFile) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const mediaType = mediaFile.type.startsWith('image/') ? 'image' : 'video';
        const previewItem = document.createElement('div');
        previewItem.className = 'text-center';

        let mediaElement;
        if (mediaType === 'image') {
          mediaElement = document.createElement('img');
          mediaElement.src = e.target.result;
          mediaElement.className = 'w-32 h-32 object-cover rounded';
        } else {
          mediaElement = document.createElement('video');
          mediaElement.src = e.target.result;
          mediaElement.controls = true;
          mediaElement.className = 'w-32 h-32 object-cover rounded';
        }

        const caption = document.createElement('p');
        caption.textContent = mediaTitle;

        previewItem.appendChild(mediaElement);
        previewItem.appendChild(caption);
        previewContainer.appendChild(previewItem);
      };

      reader.readAsDataURL(mediaFile);
    });
  </script>
</body>
</html>
